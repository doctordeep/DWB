{% assign taxonomy = page.autopages.display_name | downcase | slugify %}
{% assign tag = site.data.taxonomy[taxonomy] %}
{% assign feature_image = page.image.feature | default: page.image.path %}

<header class="intro {% if feature_image and page.image.cover %}cover{% endif %}">
  {% if feature_image %}
    <div class="intro-image">
      {% assign f = feature_image | split: '.' %}
        <noscript><img src="{{ f[0] | relative_url }}-320.{{ f[1] }}"></noscript>
        <img data-sizes="auto"
             src="{{ f[0] | relative_url }}-lq.{{ f[1] }}"
             data-srcset="{{ f[0] | relative_url }}-lq.{{ f[1] }} 20w,
                          {{ f[0] | relative_url }}-320.{{ f[1] }} 320w,
                          {{ f[0] | relative_url }}-768.{{ f[1] }} 768w,
                          {{ f[0] | relative_url }}-1024.{{ f[1] }} 1024w,
                          {{ f[0] | relative_url }}.{{ f[1] }} 1920w"
             alt="{{ page.title }}"
             class="lazyload blur-up">
      {% if page.image.caption %}{% include image-caption.html %}{% endif %}
    </div>
  {% endif %}

  {% include breadcrumbs.html %}

  <div class="inner">
    <div class="intro-text">
      <h1 class="intro-title">{{ page.alt_title | default: page.autopage.display_name | default: page.title | default: site.title | markdownify | strip_html | widont }}</h1>
      {% if page.sub_title %}
        <p class="intro-subtitle">{{ page.sub_title | markdownify | strip_html }}</p>
      {% endif %}

      {% unless page.layout == 'archive' %}
        {% if page.date %}
          {% include author %}
          <p class="entry-meta">
            <span class="byline-item"><svg class="icon icon--calendar" width="16px" height="16px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" style="enable-background:new 0 0 16 16;" xml:space="preserve"><path d="M12,2V0h-2v2H6V0H4v2H0v14h16V2H12z M14,14H2V4h2v2h2V4h4v2h2V4h2V14z"/></svg><time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: '%B %-d, %Y' }}</time></span>
            {% if page.work %}
              <span class="byline-item"><svg class="icon icon--folder" width="16px" height="16px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" style="enable-background:new 0 0 16 16;" xml:space="preserve"><path d="M0,16h16V6h-2V2H8.5L7,0H0C0,0,0,16,0,16z M14,8v6H6V8H14z M7.5,4H12v2H4v8H2V2h4L7.5,4z"/></svg>&nbsp;{{ page.work | markdownify | remove: '<p>' | remove: '</p>' }}</span>
            {% endif %}
            {% if page.read_time %}
              <span class="byline-item"><svg class="icon icon--stopwatch" width="16px" height="16px" xmlns="http://www.w3.org/2000/svg" viewBox="15 309.7 16 16"><g><path d="M23.9 315.1v3.6c0 .5-.4.9-.9.9s-.9-.4-.9-.9v-3.6h1.8z"/><path d="M30.1 317.7c.5 3.9-2.3 7.5-6.2 7.9-3.9.5-7.5-2.3-7.9-6.2-.5-3.9 2.3-7.5 6.2-7.9v-1.8H24v1.8c1.1.1 2.7.7 3.5 1.4l1.3-1.3 1.3 1.3-1.3 1.3c.5.9 1.2 2.5 1.3 3.5zm-1.8.9c0-2.9-2.4-5.3-5.3-5.3s-5.3 2.4-5.3 5.3 2.4 5.3 5.3 5.3 5.3-2.3 5.3-5.3z"/></g></svg>{% capture read_time %}{% include read-time.html %}{% endcapture %}{{ read_time | strip }}</span>
            {% endif %}
            {% if page.comments == true and site.data.comments[page.slug].size > 0 %}
              <span class="byline-item"><a href="#comments"><svg class="icon icon--comments" width="16px" height="16px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16" style="enable-background:new 0 0 16 16;" xml:space="preserve"><g><path d="M5,9h7V7H4v2H5z M12,4H4v2h8V4z M16,0H0v13h8.5l4.5,3v-3h3V0z M14,11h-3v1.5L8.5,11H2V2h12V11z"/></g></svg>{{ site.data.comments[page.slug] | size }}&nbsp;Comment{% if site.data.comments[page.slug].size > 1 %}s{% endif %}</a></span>
            {% endif %}
          </p>
        {% endif %}
      {% endunless %}

      {% if page.introduction %}
        <div class="intro-more">
          {{ page.introduction | markdownify }}
        </div>
      {% elsif page.layout == 'autopage_tags' %}
        <div class="intro-more">
          {% if tag.description %}
            {{ tag.description | markdownify }}
          {% else %}
            <p>An archive of posts tagged <em>{{ page.autopages.display_name }}</em>.</p>
          {% endif %}
        </div>
      {% endif %}

      {% if page.actions %}
        <ul class="intro-actions">
          {% for action in page.actions %}
            <li><a href="{{ action.url }}" class="btn">{{ action.label }}</a></li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  </div>
</header>
